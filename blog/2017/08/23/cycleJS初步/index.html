<!-- -> 定义页面布局--><!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge, chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta name="keywords" content="Mrzjd Mrzebra hexo IT font-end 前端 技术"><meta name="keywords" content="Programming,CycleJS,FRP"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.bootcss.com/github-markdown-css/2.8.0/github-markdown.min.css"><link rel="stylesheet" href="/blog/less/main.css"><link rel="icon" href="/blog/images/favicon.png"><title>CycleJS初步</title><script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><script src="/blog/js/article.js"></script></head><body><header class="header"><h1 class="logo"><a href="/blog/" style="background-image:url(/blog//images/zblog-logo.png);">zblog</a></h1><i class="icon-list fa fa-bars"></i></header><div class="list-container"><ul class="header-list"><li class="header-item"><a href="/blog" title="HOME">HOME</a></li><li class="header-item"><a href="/blog/archives" title="Archives">Archives</a></li><li class="header-item"><a href="https://github.com/mrzjd" title="Github">Github</a></li></ul><div class="list-close"><i class="icon-close fa fa-times-circle-o"></i></div></div><div class="content"><article><div class="title-box"><h1 class="title"><span class="arti-tag" style="background:#BFFC92;">CycleJS</span>CycleJS初步</h1><div class="date"><i class="icon-calendar fa fa-calendar"></i><span class="time">2017.08.23</span></div></div><div class="article-text markdown-body"><h3 id="CycleJS-Module"><a href="#CycleJS-Module" class="headerlink" title="CycleJS Module"></a>CycleJS Module</h3><ul>
<li>@cycle/dom – a collection of drivers that work with DOM; it has a DOM driver and HTML driver, based on the snabdom virtual DOM library </li>
<li>@cycle/history – a driver for the History API </li>
<li>@cycle/http – a driver for HTTP requests, based on superagent </li>
<li>@cycle/isolate – a function for making scoped dataflow components</li>
<li>@cycle/jsonp – a driver for making HTTP requests through JSONP</li>
<li>@cycle/run – a run function for apps made with xstream </li>
<li>@cycle/most-run – a run function for apps made with most </li>
<li>@cycle/rxjs-run – a run function for apps made with rxjs</li>
</ul>
<h3 id="Project-CLI-代码环境配置"><a href="#Project-CLI-代码环境配置" class="headerlink" title="Project CLI - 代码环境配置"></a>Project CLI - 代码环境配置</h3><h4 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save @cycle/dom @cycle/run xstream</span><br><span class="line">npm install --save-dev babel-cli babel-register babel-preset-es2015 babelify browserify mkdirp</span><br></pre></td></tr></table></figure>
<p style="display:block;">package.json</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;prebrowserify&quot;: &quot;mkdirp dist&quot;,</span><br><span class="line">    &quot;browserify&quot;: &quot;browserify sources/main.js -t babelify --outfile dist/main.js&quot;,</span><br><span class="line">    &quot;start&quot;: &quot;npm install &amp;&amp; npm run browserify &amp;&amp; echo &apos;OPEN index.html IN YOUR BROWSER&apos;&quot;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p style="display:block;">.babelrc</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;presets&quot;: [&quot;es2015&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>babel-cli - babel 命令行工具</li>
<li>babel-register - babel require js时转码</li>
<li>babel-preset-es2015 - babel es6 转码标准</li>
<li>babelify - babel browserify 工具</li>
<li>mkdirp - node命令行创建文件夹</li>
</ul>
<h4 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a>JSX</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save babel-plugin-transform-react-jsx snabbdom-jsx</span><br></pre></td></tr></table></figure>
<p style="display:block;">.babelrc</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;presets&quot;: [&quot;es2015&quot;],</span><br><span class="line">    &quot;plugins&quot;: [</span><br><span class="line">        [&quot;transform-react-jsx&quot;, &#123; &quot;pragma&quot;: &quot;html&quot; &#125;]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// - main.js</span><br><span class="line">import &#123;html&#125; from &apos;snabbdom-jsx&apos;;</span><br></pre></td></tr></table></figure>
<h3 id="Code-Frame-代码结构逻辑"><a href="#Code-Frame-代码结构逻辑" class="headerlink" title="Code Frame - 代码结构逻辑"></a>Code Frame - 代码结构逻辑</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import xs from &quot;xstream&quot;;</span><br><span class="line">import &#123; run &#125; from &quot;@cycle/run&quot;;</span><br><span class="line">import &#123; makeDOMDriver &#125; from &quot;@cycle/dom&quot;;</span><br><span class="line">import &#123;html&#125; from &apos;snabbdom-jsx&apos;;</span><br><span class="line"></span><br><span class="line">function main(sources) &#123;</span><br><span class="line">    // -&gt; Driver传入sources</span><br><span class="line">    const sinks = &#123;</span><br><span class="line">        DOM: domStream$</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // -&gt; 输出sinks</span><br><span class="line">    return sinks;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">run(main, &#123;</span><br><span class="line">    DOM: makeDOMDriver(&apos;#app&apos;) // -&gt; Driver</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p style="display:block;">Drivers : -&gt; 获取sinks( 输出流 ) -&gt; Writeable Stream -&gt; 转换成sources<br>Main() : -&gt; sources -&gt; 获取原始流 -&gt; operators -&gt; sinks(输出流)</p>


<h3 id="Code-Construction-代码框架-MVI"><a href="#Code-Construction-代码框架-MVI" class="headerlink" title="Code Construction - 代码框架 - MVI"></a>Code Construction - 代码框架 - MVI</h3><blockquote>
<p>MVI 是一种简单的模式来将 main() 函数重构为三个部分：Intent（监听用户）、Model（处理信息）、和 View（返回输出）</p>
</blockquote>
<ul>
<li>intent() 函数<ul>
<li>目的: 将 DOM 事件解释为用户的意图 actions</li>
<li>输入: DOM source</li>
<li>输出: Action 流</li>
</ul>
</li>
<li>model() 函数<ul>
<li>目的: 管理状态</li>
<li>输入: Action 流</li>
<li>输出: State 流</li>
</ul>
</li>
<li>view() 函数<ul>
<li>目的: 视觉地展示 Model 中的状态</li>
<li>输入: State 流</li>
<li>输出: 作为 DOM Driver sink 的虚拟 DOM 节点流</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function main(sources) &#123;</span><br><span class="line">    // const action$ = intent(sources.DOM);</span><br><span class="line"></span><br><span class="line">    // const state$ = model(action$);</span><br><span class="line"></span><br><span class="line">    // const vdom$ = view(state$);</span><br><span class="line"></span><br><span class="line">    // return &#123;</span><br><span class="line">    //     DOM: vdom$</span><br><span class="line">    // &#125;;</span><br><span class="line"></span><br><span class="line">    return &#123; DOM: view(model(intent(sources.DOM))) &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Components-in-CycleJS"><a href="#Components-in-CycleJS" class="headerlink" title="Components in CycleJS"></a>Components in CycleJS</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// - 定义组件</span><br><span class="line">function Components(sources) &#123;</span><br><span class="line">    const props$ = sources.props; // -&gt; 获取组件属性值</span><br><span class="line"></span><br><span class="line">    const action$ = intent(sources.DOM);</span><br><span class="line">    const state$ = model(action$, props$); // -&gt; 将属性值置入组件状态</span><br><span class="line">    const vdom$ = view(state$);</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">        DOM: vdom$,</span><br><span class="line">        value: state$.map(state =&gt; state.value) // -&gt; 组件的当前值/流</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line">// - 使用组件</span><br><span class="line">function main(sources) &#123;</span><br><span class="line">    const props$ = xs.of(componentsPropObj);</span><br><span class="line"></span><br><span class="line">    const compSources = &#123; DOM: sources.DOM, props: props$ &#125;;</span><br><span class="line">    const comp = Components(compSources);</span><br><span class="line"></span><br><span class="line">    const childDom$ = comp.DOM; // -&gt; 子组件dom</span><br><span class="line">    const childValue$ = comp.value; // -&gt; 子组件value</span><br><span class="line"></span><br><span class="line">    const vdom$ = xs.combine(childDom$, childValue$)</span><br><span class="line">        .map(([childVDom, childVal]) =&gt; &#123;</span><br><span class="line">			return &lt;html&gt;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">        DOM: vdom$</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p style="display:block;">组件的作用域 - 隔离组件</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// -&gt; Method-A</span><br><span class="line">compSources = &#123; DOM: sources.DOM.select(&apos;.compNamespace&apos;), props: props$ &#125;;</span><br><span class="line"></span><br><span class="line">childDom$ = comp.DOM</span><br><span class="line">	.map(vnode =&gt; &#123;</span><br><span class="line">		vnode.sel += &apos;.compNamespace&apos;;</span><br><span class="line">		return vnode;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">// -&gt; Method-B</span><br><span class="line">const &#123;isolateSource, isolateSink&#125; = sources.DOM;</span><br><span class="line">compSources = &#123; DOM: isolateSource(sources.DOM, &apos;weight&apos;), props: props$ &#125;;</span><br><span class="line">childDom$ = isolateSink(comp.DOM, &apos;weight&apos;);</span><br><span class="line"></span><br><span class="line">// -&gt; Method-C</span><br><span class="line">import isolate from &quot;@cycle/isolate&quot;;</span><br><span class="line">const IsoComponents = isolate(Components, NameSpace);</span><br><span class="line">const comp = IsoComponents(compSources);</span><br></pre></td></tr></table></figure>
<h3 id="Drivers-in-CycleJS"><a href="#Drivers-in-CycleJS" class="headerlink" title="Drivers in CycleJS"></a>Drivers in CycleJS</h3><blockquote>
<p>上文介绍了Cycle中业务代码的重头戏 - main()函数的编写，接下来深入CycleJS - Driver底层驱动的编写</p>
</blockquote>
<p style="display:block;">比较复杂，日后拓展：domDriver / httpDriver</p>


<h3 id="造轮子"><a href="#造轮子" class="headerlink" title="造轮子"></a>造轮子</h3><ul>
<li>轮播图</li>
<li>TODO LIST</li>
</ul>
</div></article></div><footer class="footer"><p class="info">Welcome to mrzjd's blog!</p><div class="infobox"><ul class="contacts"><li class="contacts-i">QQ: 390303304</li><li class="contacts-i">Mail: 390303304@qq.com</li></ul><p>Powered by hexo and github. The theme is zebra-theme.</p></div></footer></body></html>