<!-- -> 定义页面布局--><!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge, chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta name="keywords" content="Mrzjd Mrzebra hexo IT font-end 前端 技术"><meta name="keywords" content="Nodejs"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.bootcss.com/github-markdown-css/2.8.0/github-markdown.min.css"><link rel="stylesheet" href="/blog/less/main.css"><link rel="icon" href="/blog/images/favicon.png"><title>Nodejs总结4-process/child_process进程管理</title><script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><script src="/blog/js/article.js"></script></head><body><header class="header"><h1 class="logo"><a href="/blog/" style="background-image:url(/blog//images/zblog-logo.png);">zblog</a></h1><i class="icon-list fa fa-bars"></i></header><div class="list-container"><ul class="header-list"><li class="header-item"><a href="/blog" title="HOME">HOME</a></li><li class="header-item"><a href="/blog/archives" title="Archives">Archives</a></li><li class="header-item"><a href="https://github.com/mrzjd" title="Github">Github</a></li></ul><div class="list-close"><i class="icon-close fa fa-times-circle-o"></i></div></div><div class="content"><article><div class="title-box"><h1 class="title"><span class="arti-tag" style="background:#43853d;">Nodejs</span>Nodejs总结4-process/child_process进程管理</h1><div class="date"><i class="icon-calendar fa fa-calendar"></i><span class="time">2017.11.13</span></div></div><div class="article-text markdown-body"><h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>作为服务器端的JavaScript, 在摆脱了浏览器的限制之后, 终于拥有很多系统的操作能力。这篇文章就主要来介绍Nodejs的进程管理功能。</p>
<h2 id="process-主进程"><a href="#process-主进程" class="headerlink" title="process - 主进程"></a>process - 主进程</h2><h3 id="process事件"><a href="#process事件" class="headerlink" title="process事件"></a>process事件</h3><blockquote>
<p>process 对象是一个 global （全局变量），提供有关信息，控制当前 Node.js 进程。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// Events:</span><br><span class="line">// &apos;beforeExit&apos;: -&gt; 回调可包含异步操作(说明在这个事件之后Nodejs还会进行eventloop)</span><br><span class="line">//               -&gt; process.exit()/throw error不会触发该事件</span><br><span class="line"></span><br><span class="line">// &apos;exit&apos;: process.exit()/eventloop unalive触发 -&gt; 回调不允许异步操作</span><br><span class="line"></span><br><span class="line">// &apos;disconnect&apos;</span><br><span class="line">// &apos;message&apos;</span><br><span class="line"></span><br><span class="line">// &apos;uncaughtException&apos; -&gt; 有未捕获异常抛出时，用于处理程序异常退出时资源清理操作</span><br><span class="line">//                     -&gt; 不要用于重启应用，更可靠的方式是通过另外一个进程来探测应用是否出错</span><br><span class="line"></span><br><span class="line">// &apos;warning&apos; -&gt; 应用性能，缺陷，安全隐患</span><br><span class="line">// &apos;rejectionHandled&apos;/&apos;unhandledRejection&apos; -&gt; promise reject被处理和不被处理下触发</span><br><span class="line"></span><br><span class="line">// Signal Event</span><br><span class="line">// 当Node.js进程接收到一个信号时，会触发信号事件</span><br><span class="line">// &lt;Ctrl&gt;-C -&gt; &apos;SIGINT&apos;</span><br><span class="line">process.on(&apos;SIGINT&apos;, () =&gt; &#123;</span><br><span class="line">    console.log(&apos;Received SIGINT.  Press Control-D to exit.&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="process属性"><a href="#process属性" class="headerlink" title="process属性"></a>process属性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">process.arch; //String-处理器架构 &apos;arm&apos;/&apos;x64&apos;等</span><br><span class="line">process.argv; //Array-启动参数 // process.argv0-&gt;对应第一个参数</span><br><span class="line">process.config; //Object-nodejs配置项</span><br><span class="line">process.env; //用户环境</span><br><span class="line">process.title; //进程名字</span><br><span class="line">process.version/versions; //执行环境版本信息</span><br><span class="line"></span><br><span class="line">process.execArgv; //nodejs特定命令项 // --harmony</span><br><span class="line">process.execPath; //node可执行文件的绝对路径</span><br><span class="line">process.exitCode; //进程结束时的状态码</span><br><span class="line"></span><br><span class="line">process.pid; //PID</span><br><span class="line">process.platform; //平台 &apos;linux&apos; &apos;win32&apos;</span><br><span class="line"></span><br><span class="line">process.stderr; //错误流</span><br><span class="line">process.stdin; //输入流</span><br><span class="line">process.stdout; //输出流</span><br></pre></td></tr></table></figure>
<h3 id="process方法"><a href="#process方法" class="headerlink" title="process方法"></a>process方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">process.abort(); //进程立即结束</span><br><span class="line">process.exit([code]); //进程退出</span><br><span class="line">process.disconnect(); //关闭进程IPC通道</span><br><span class="line"></span><br><span class="line">process.cwd(); //当前工作目录</span><br><span class="line">process.chdir(dir); //变更工作目录</span><br><span class="line">process.cpuUsage([previousValue]);</span><br><span class="line">process.memoryUsage()</span><br><span class="line"></span><br><span class="line">process.emitWarning(warning[, options]); //</span><br><span class="line">process.kill(pid[, signal]); //将signal发送给pid标识的进程。</span><br><span class="line">process.uptime(); //进程运行时间</span><br><span class="line"></span><br><span class="line">process.nextTick(callback[, ...args])</span><br></pre></td></tr></table></figure>
<p><strong>重点process.nextTick(callback[, …args])</strong></p>
<blockquote>
<p>回调函数将在执行栈的最末尾执行，而不是eventloop的顶端</p>
</blockquote>
<h2 id="child-process-子进程"><a href="#child-process-子进程" class="headerlink" title="child_process 子进程"></a>child_process 子进程</h2><h3 id="1-创建子进程"><a href="#1-创建子进程" class="headerlink" title="1.创建子进程"></a>1.创建子进程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ls = child_process.spawn(); // 在 Node.js 的父进程与衍生的子进程之间会建立 stdin、stdout 和 stderr 的管道</span><br><span class="line">ls.stdin.on(&apos;data&apos;, listener);</span><br><span class="line">ls.stdout.on(&apos;data&apos;, listener);</span><br><span class="line">ls.stderr.on(&apos;data&apos;, listener);</span><br><span class="line"></span><br><span class="line">child_process.exec(); //1. 衍生一个 shell 并在 shell 上运行命令</span><br><span class="line">child_process.execFile(); //2. 直接衍生命令，且无需先衍生一个 shell</span><br><span class="line">child_process.fork(); //3. 衍生一个新的 Node.js 进程</span><br><span class="line"></span><br><span class="line">//注意：</span><br><span class="line">//在Unix下, execFile效率更高, 因为不需要shell</span><br><span class="line">//但在window中执行.bat/.cmd时, execFile不可执行, 可以通过exec/spawn指定shell</span><br></pre></td></tr></table></figure>
<h3 id="2-ChildProcess-类"><a href="#2-ChildProcess-类" class="headerlink" title="2.ChildProcess 类"></a>2.ChildProcess 类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// Events: &apos;close&apos;, &apos;disconnect&apos;, &apos;error&apos;, &apos;exit&apos;, &apos;message&apos;</span><br><span class="line"></span><br><span class="line">// Property: connected, channel, killed, pid</span><br><span class="line"></span><br><span class="line">// Methods: disconnect, kill, send,</span><br><span class="line"></span><br><span class="line">// subprocess.stdio -&gt; stdin, stdout, stderr</span><br></pre></td></tr></table></figure>
<h2 id="应用实战"><a href="#应用实战" class="headerlink" title="应用实战"></a>应用实战</h2><ul>
<li>多任务管理 - 多视频转码</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://nodejs.cn/api/process.html#process_process" target="_blank" rel="noopener">nodejs-process</a><br><a href="http://nodejs.cn/api/child_process.html#child_process_child_process" target="_blank" rel="noopener">nodejs-child_process</a></p>
</div></article></div><footer class="footer"><p class="info">Welcome to mrzjd's blog!</p><div class="infobox"><ul class="contacts"><li class="contacts-i">QQ: 390303304</li><li class="contacts-i">Mail: 390303304@qq.com</li></ul><p>Powered by hexo and github. The theme is zebra-theme.</p></div></footer></body></html>