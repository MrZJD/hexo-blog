<!-- -> 定义页面布局--><!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge, chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta name="keywords" content="Mrzjd Mrzebra hexo IT font-end 前端 技术"><meta name="keywords" content="Nodejs"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.bootcss.com/github-markdown-css/2.8.0/github-markdown.min.css"><link rel="stylesheet" href="/blog/less/main.css"><link rel="icon" href="/blog/images/favicon.png"><title>Nodejs总结5-利用readline,repl创建交互式应用</title><script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><script src="/blog/js/article.js"></script></head><body><header class="header"><h1 class="logo"><a href="/blog/" style="background-image:url(/blog//images/zblog-logo.png);">zblog</a></h1><i class="icon-list fa fa-bars"></i></header><div class="list-container"><ul class="header-list"><li class="header-item"><a href="/blog" title="HOME">HOME</a></li><li class="header-item"><a href="/blog/archives" title="Archives">Archives</a></li><li class="header-item"><a href="https://github.com/mrzjd" title="Github">Github</a></li></ul><div class="list-close"><i class="icon-close fa fa-times-circle-o"></i></div></div><div class="content"><article><div class="title-box"><h1 class="title"><span class="arti-tag" style="background:#43853d;">Nodejs</span>Nodejs总结5-利用readline,repl创建交互式应用</h1><div class="date"><i class="icon-calendar fa fa-calendar"></i><span class="time">2017.11.14</span></div></div><div class="article-text markdown-body"><h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>在C语言中我们有scanf函数来获取用户在命令行中的输入，而在浏览器JavaScript中由于直接通过UI界面与用户交互，所以只有console.log等输出函数。但是Nodejs扩展了JS的应用场景，相应也为开放着封装了相应的接口。</p>
<h2 id="readline-模块"><a href="#readline-模块" class="headerlink" title="readline 模块"></a>readline 模块</h2><blockquote>
<p>实际上还是基于流的封装<br>如果是process中的stdin,stdout,stderr可变化流-&gt;则从控制台中读取输出<br>如果是file stream-&gt;则可以输出到文件中</p>
</blockquote>
<h3 id="readline-Interface-类"><a href="#readline-Interface-类" class="headerlink" title="readline.Interface 类"></a>readline.Interface 类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">var rl = readline.createInterface(&#123;</span><br><span class="line">    input: inputReadableStream,</span><br><span class="line">    output: outputWritableStream</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// Events:</span><br><span class="line">// &apos;close&apos; //-&gt; 已撤回对input/output的控制后</span><br><span class="line">// &apos;line&apos; //-&gt; input接收到(\n,\r,\r\n)换行结束符时触发</span><br><span class="line">// &apos;pause&apos;/&apos;resume&apos;</span><br><span class="line"></span><br><span class="line">// &apos;SIGTSTP&apos; //-&gt; 接收到一个 &lt;ctrl&gt;-Z 输入</span><br><span class="line">// &apos;SIGCONT&apos; //-&gt; Nodejs进程从后台移回前台时</span><br><span class="line">// &apos;SIGINT&apos; //-&gt; 接收到一个 &lt;ctrl&gt;-C 输入</span><br><span class="line"></span><br><span class="line">// Methods:</span><br><span class="line">// rl.close()</span><br><span class="line">// rl.pause() //暂停input流</span><br><span class="line">// rl.resume()</span><br><span class="line">// rl.question(query, callback)</span><br><span class="line">// rl.setPrompt(prompt)</span><br><span class="line">// rl.write(data[, key])</span><br></pre></td></tr></table></figure>
<h3 id="readline-全局方法"><a href="#readline-全局方法" class="headerlink" title="readline 全局方法"></a>readline 全局方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// readline.clearLine(stream, dir)</span><br><span class="line">// readline.cursorTo(stream, x, y)</span><br><span class="line">// readline.moveCursor(stream, dx, dy)</span><br><span class="line">// readline.emitKeypressEvents(stream[, interface])</span><br><span class="line"></span><br><span class="line">// readline.createInterface(options)</span><br></pre></td></tr></table></figure>
<h2 id="repl-交互解释器模块"><a href="#repl-交互解释器模块" class="headerlink" title="repl-交互解释器模块"></a>repl-交互解释器模块</h2><blockquote>
<p>repl 模块提供了一种“读取-求值-输出”循环（REPL）的实现</p>
</blockquote>
<p>在一些特点场景下我们需要运行用户的输入(将用户的输入作为代码执行)，而不仅仅是将用户输入作为参数。这个时候repl模块就可以发挥作用了。</p>
<h3 id="repl-REPLServer-类"><a href="#repl-REPLServer-类" class="headerlink" title="repl.REPLServer 类"></a>repl.REPLServer 类</h3><blockquote>
<p>继承自 readline.Interface 类</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// 通过repl.start() 创建</span><br><span class="line"></span><br><span class="line">// Events:</span><br><span class="line">// &apos;exit&apos;/&apos;reset&apos;</span><br><span class="line"></span><br><span class="line">// Methods:</span><br><span class="line">// replServer.defineCommand(keyword, cmd)</span><br><span class="line">// replServer.displayPrompt([preserveCursor])</span><br><span class="line"></span><br><span class="line">// 命令与特殊键</span><br><span class="line">// &apos;.break&apos; -&gt; &lt;ctrl&gt;-C</span><br><span class="line">// &apos;.clear&apos; -&gt; 重置repl的context</span><br><span class="line">// &apos;.exit&apos;</span><br><span class="line">// &apos;.help&apos;</span><br><span class="line">// &apos;.save&apos;</span><br><span class="line">// &apos;.load&apos;</span><br><span class="line">// &apos;.editor&apos; -&gt; 进入编辑模式（&lt;ctrl&gt;-D 完成，&lt;ctrl&gt;-C 取消）</span><br><span class="line"></span><br><span class="line">// 全局变量</span><br><span class="line">// repl.start(&apos;&gt; &apos;).context.m = msg; // 定义context中的变量</span><br><span class="line">// _ // 解释器会把最近一次解释的表达式的结果赋值给变量 _</span><br><span class="line"></span><br><span class="line">// 注意</span><br><span class="line">// 可自定义输入的执行器 -&gt; 对应start中的eavl参数(eval默认)</span><br><span class="line">// 也可自定义输出 -&gt; 对应writer参数(util.inspect默认)</span><br></pre></td></tr></table></figure>
<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><ul>
<li>编写一个初始化项目的repl应用 - 类似于npm init创建项目</li>
<li>通过socket远程执行用户输入</li>
</ul>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="http://nodejs.cn/api/readline.html#readline_readline" target="_blank" rel="noopener">nodejs - readline</a><br><a href="http://nodejs.cn/api/repl.html#repl_repl" target="_blank" rel="noopener">nodejs - repl</a></p>
</div></article></div><footer class="footer"><p class="info">Welcome to mrzjd's blog!</p><div class="infobox"><ul class="contacts"><li class="contacts-i">QQ: 390303304</li><li class="contacts-i">Mail: 390303304@qq.com</li></ul><p>Powered by hexo and github. The theme is zebra-theme.</p></div></footer></body></html>